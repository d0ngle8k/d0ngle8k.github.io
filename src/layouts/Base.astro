---
import '../styles/global.css';
import { ThemeSwitcher } from '../components/ThemeSwitcher';
import { MobileNav } from '../components/MobileNav';
import { Starfield } from '../components/Starfield';
import { ViewTransitions } from 'astro:transitions';

const { title = 'Portfolio', description = 'Portfolio website' } = Astro.props;

const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/work', label: 'Work' },
  { href: '/blog', label: 'Blog' },
  { href: '/projects', label: 'Projects' }
];
---
<!DOCTYPE html>
<html lang="en" class="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <ViewTransitions />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous" />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="text-primary">
    <!-- Global animated starfield background for dark theme -->
    <div class="fixed inset-0 -z-10">
      <Starfield client:load />
    </div>
    <header class="sticky top-0 z-20 backdrop-blur bg-surface/80 border-b border-white/5">
      <nav class="mx-auto max-w-6xl px-4 sm:px-6 py-3 sm:py-4">
        <div class="flex items-center justify-between gap-2 sm:gap-4">
          <!-- Logo -->
          <div class="flex items-center gap-2 font-bold tracking-tight flex-shrink-0">
            <span class="h-6 w-6 sm:h-8 sm:w-8 rounded-full bg-white/10 inline-flex items-center justify-center flex-shrink-0 text-xs sm:text-base">T</span>
            <span class="text-xs sm:text-base truncate">Truong Gia Thanh</span>
          </div>
          
          <!-- Center Nav Links -->
          <ul class="hidden md:flex items-center justify-center gap-2 lg:gap-6 text-xs lg:text-sm flex-1 whitespace-nowrap">
            {navLinks.map(({ href, label }) => (
              <li>
                <a href={href} class="hover:text-white transition-colors" aria-label={label}>
                  {label}
                </a>
              </li>
            ))}
          </ul>
          
          <!-- Right Side: Search, Theme & Mobile Menu -->
          <div class="flex items-center gap-2 lg:gap-3 flex-shrink-0">
            <form action="/search" class="hidden items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1 text-sm text-secondary focus-within:border-white/30 lg:flex">
              <span aria-hidden="true">üîç</span>
              <input
                name="q"
                type="search"
                placeholder="Search"
                class="w-24 lg:w-36 bg-transparent text-primary placeholder:text-secondary focus:outline-none text-xs lg:text-sm"
              />
            </form>
            <a
              href="/search"
              aria-label="Search"
              class="inline-flex h-8 w-8 sm:h-9 sm:w-9 items-center justify-center rounded-full border border-white/10 bg-white/5 text-base sm:text-lg lg:hidden transition-all hover:bg-white/10"
            >
              üîç
            </a>
            <ThemeSwitcher client:load />
            <MobileNav client:load links={navLinks} />
          </div>
        </div>
      </nav>
    </header>

    <main class="min-h-screen">
      <slot />
    </main>

    <footer class="border-t border-white/5 bg-card/60 backdrop-blur">
      <div class="mx-auto flex max-w-6xl flex-col gap-4 px-4 sm:px-6 py-6 sm:py-8 md:flex-row md:items-center md:justify-between text-xs sm:text-sm text-secondary">
        <div class="flex items-center gap-2">
          <div class="min-w-0">
            <div class="font-semibold text-primary text-xs sm:text-sm">Truong Gia Thanh</div>
            <div class="flex items-center gap-2 text-xs sm:text-sm text-secondary">
              <span class="relative flex h-2.5 w-2.5 flex-shrink-0">
                <span class="absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-70 animate-ping"></span>
                <span class="relative inline-flex h-2.5 w-2.5 rounded-full bg-emerald-400 shadow-[0_0_0.75rem_rgba(74,222,128,0.8)]"></span>
              </span>
              <span class="text-primary">All systems normal</span>
            </div>
          </div>
        </div>
        <div class="flex gap-4 text-secondary">
          <a aria-label="Email" href="mailto:trggiathanh@outlook.com" class="hover:text-white" title="Email">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" class="h-5 w-5">
              <rect x="3" y="5" width="18" height="14" rx="2" ry="2" />
              <path d="m3 7 9 6 9-6" />
            </svg>
          </a>
          <a aria-label="GitHub" href="https://github.com/d0ngle8k" target="_blank" rel="noopener noreferrer" class="hover:text-white" title="GitHub">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-5 w-5">
              <path d="M12 0C5.37 0 0 5.37 0 12a12 12 0 0 0 8.21 11.44c.6.11.82-.26.82-.58v-2.02c-3.34.73-4.04-1.61-4.04-1.61-.55-1.39-1.35-1.76-1.35-1.76-1.1-.75.08-.73.08-.73 1.22.09 1.87 1.25 1.87 1.25 1.08 1.85 2.83 1.32 3.52 1.01.11-.78.42-1.32.76-1.62-2.67-.3-5.48-1.33-5.48-5.93 0-1.31.47-2.38 1.24-3.22-.12-.3-.54-1.52.12-3.16 0 0 1.01-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.66 1.64.24 2.86.12 3.16.77.84 1.24 1.91 1.24 3.22 0 4.61-2.81 5.63-5.5 5.92.43.37.82 1.1.82 2.23v3.3c0 .32.22.7.82.58A12 12 0 0 0 24 12c0-6.63-5.37-12-12-12Z" />
            </svg>
          </a>
          <a aria-label="LinkedIn" href="https://www.linkedin.com/in/d0ngle8k/" target="_blank" rel="noopener noreferrer" class="hover:text-white" title="LinkedIn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-5 w-5">
              <path d="M20.45 20.45h-3.56v-5.6c0-1.34-.02-3.06-1.87-3.06-1.87 0-2.16 1.46-2.16 2.96v5.7H9.3V9h3.42v1.56h.05c.48-.9 1.65-1.85 3.4-1.85 3.64 0 4.31 2.4 4.31 5.52zM5.34 7.43a2.07 2.07 0 1 1 0-4.14 2.07 2.07 0 0 1 0 4.14m1.78 13.02H3.56V9h3.56z" />
            </svg>
          </a>
          <a aria-label="X" href="https://x.com/d0ngle8k" target="_blank" rel="noopener noreferrer" class="hover:text-white" title="X">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-5 w-5">
              <path d="M18.36 3H21l-6.52 7.44L22 21h-5.53l-4.33-5.2L7 21H4.35l7-7.98L2.63 3h5.68l3.9 4.69z" />
            </svg>
          </a>
        </div>
      </div>
    </footer>

    <button
      id="back-to-top"
      class="fixed bottom-6 right-6 rounded-full border border-white/20 bg-card/80 px-3 py-2 text-xs text-primary shadow hover:-translate-y-0.5 transition cursor-pointer"
    >
      Back to top
    </button>

    <script is:inline>
      function setupBackToTop() {
        const btn = document.getElementById('back-to-top');
        if (btn) {
          btn.onclick = () => {
            window.scrollTo({
              top: 0,
              behavior: 'smooth'
            });
          };
        }
      }

      // Run on initial page load
      setupBackToTop();

      // Re-run after view transitions
      document.addEventListener('astro:after-swap', setupBackToTop);
    </script>
  </body>
</html>
